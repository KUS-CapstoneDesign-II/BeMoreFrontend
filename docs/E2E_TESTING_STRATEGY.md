# E2E Testing Strategy - Render Cold Start ëŒ€ì‘

> **ì‘ì„±ì¼**: 2025-01-11
> **ëŒ€ìƒ**: Render í”„ë¦¬í‹°ì–´ ë°±ì—”ë“œ + Vercel í”„ë¡ íŠ¸ì—”ë“œ í™˜ê²½

## ğŸ“‹ ëª©ì°¨

1. [ë¬¸ì œ ì •ì˜](#ë¬¸ì œ-ì •ì˜)
2. [Render í”„ë¦¬í‹°ì–´ íŠ¹ì„±](#render-í”„ë¦¬í‹°ì–´-íŠ¹ì„±)
3. [í…ŒìŠ¤íŠ¸ ì „ëµ](#í…ŒìŠ¤íŠ¸-ì „ëµ)
4. [êµ¬í˜„ ìƒì„¸](#êµ¬í˜„-ìƒì„¸)
5. [í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤](#í…ŒìŠ¤íŠ¸-ì‹œë‚˜ë¦¬ì˜¤)
6. [ì˜ˆìƒ ê²°ê³¼](#ì˜ˆìƒ-ê²°ê³¼)
7. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

---

## ë¬¸ì œ ì •ì˜

### í•µì‹¬ ë¬¸ì œ
Render í”„ë¦¬í‹°ì–´ëŠ” **15ë¶„ ë¹„í™œì„± ì‹œ ìë™ ìŠ¬ë¦½**ë˜ë©°, ì²« ìš”ì²­ ì‹œ **30-60ì´ˆì˜ ì½œë“œ ìŠ¤íƒ€íŠ¸** ì‹œê°„ì´ í•„ìš”í•©ë‹ˆë‹¤.

### ì˜í–¥
- E2E í…ŒìŠ¤íŠ¸ê°€ ë°±ì—”ë“œ ì‘ë‹µ ì—†ìŒìœ¼ë¡œ ì‹¤íŒ¨
- ë¡œê·¸ì¸ API íƒ€ì„ì•„ì›ƒ (45ì´ˆ â†’ 60ì´ˆ í•„ìš”)
- CI/CD íŒŒì´í”„ë¼ì¸ì—ì„œ ê°„í—ì  ì‹¤íŒ¨ ë°œìƒ

---

## Render í”„ë¦¬í‹°ì–´ íŠ¹ì„±

### ìŠ¬ë¦½ ì¡°ê±´
```
15ë¶„ ë¹„í™œì„± â†’ ìë™ ìŠ¬ë¦½
```

### ì›œì—… ì‹œê°„
| ìƒíƒœ | ì›œì—… ì‹œê°„ | ì²« ìš”ì²­ ì‘ë‹µ |
|------|----------|------------|
| **ìŠ¬ë¦½ ì¤‘** (15ë¶„+) | 30-60ì´ˆ | ëŠë¦¼ (30-60ì´ˆ) |
| **ì›œ ìƒíƒœ** (<15ë¶„) | 0-3ì´ˆ | ë¹ ë¦„ (100-500ms) |

### ì½œë“œ ìŠ¤íƒ€íŠ¸ ì§•í›„
- `/api/health` 15ì´ˆ+ íƒ€ì„ì•„ì›ƒ
- `/api/auth/login` 45ì´ˆ+ íƒ€ì„ì•„ì›ƒ
- ì—°ì† ìš”ì²­ ì‹¤íŒ¨ í›„ ì„±ê³µ

---

## í…ŒìŠ¤íŠ¸ ì „ëµ

### 1. ë°±ì—”ë“œ ì›œì—… ìš°ì„ 

**ëª©í‘œ**: ë¡œê·¸ì¸ ì „ì— ë°±ì—”ë“œë¥¼ ì™„ì „íˆ ê¹¨ì›ë‹ˆë‹¤.

**ë°©ë²•**:
```typescript
// 6ë²ˆ ì‹œë„, ê° 15ì´ˆ íƒ€ì„ì•„ì›ƒ, 5ì´ˆ ê°„ê²©
// ì´ ìµœëŒ€ ì‹œê°„: (15ì´ˆ Ã— 6) + (5ì´ˆ Ã— 5) = 115ì´ˆ
async function warmupBackend(page: Page): Promise<void> {
  const maxAttempts = 6;

  for (let attempt = 1; attempt <= maxAttempts; attempt++) {
    try {
      const response = await fetch(`${BACKEND_URL}/api/health`, {
        timeout: 15000
      });

      if (response.ok) {
        log(`âœ“ Backend ready (attempt ${attempt})`);
        await wait(3000); // ì¶”ê°€ ì•ˆì •í™” ì‹œê°„
        return;
      }
    } catch (error) {
      if (attempt < maxAttempts) {
        await wait(5000); // ì¬ì‹œë„ ê°„ê²©
      }
    }
  }

  log('âš ï¸ Warmup failed, continuing anyway...');
}
```

### 2. ë¡œê·¸ì¸ ì¬ì‹œë„ ë¡œì§

**ëª©í‘œ**: ë°±ì—”ë“œê°€ ì•„ì§ ê¹¨ì–´ë‚˜ì§€ ì•Šì•˜ì„ ê²½ìš° ëŒ€ì‘í•©ë‹ˆë‹¤.

**ë°©ë²•**:
```typescript
// 3ë²ˆ ì‹œë„, ê° 60ì´ˆ íƒ€ì„ì•„ì›ƒ, 10ì´ˆ/20ì´ˆ ê°„ê²©
// ì´ ìµœëŒ€ ì‹œê°„: (60ì´ˆ Ã— 3) + 10ì´ˆ + 20ì´ˆ = 210ì´ˆ (3.5ë¶„)
for (let attempt = 1; attempt <= 3; attempt++) {
  try {
    await page.waitForResponse(
      res => res.url().includes('/api/auth/login') && res.status() === 200,
      { timeout: 60000 } // 60ì´ˆ
    );

    log(`âœ“ Login successful (attempt ${attempt})`);
    break;
  } catch (error) {
    if (attempt < 3) {
      const waitTime = attempt * 10000; // 10ì´ˆ, 20ì´ˆ
      await wait(waitTime);
      continue;
    }
    throw error;
  }
}
```

### 3. ì ì§„ì  ë°±ì˜¤í”„

**ì¬ì‹œë„ ê°„ê²©**:
- 1ì°¨ ì‹¤íŒ¨ â†’ 10ì´ˆ ëŒ€ê¸°
- 2ì°¨ ì‹¤íŒ¨ â†’ 20ì´ˆ ëŒ€ê¸°
- 3ì°¨ ì‹¤íŒ¨ â†’ ì—ëŸ¬

**ê·¼ê±°**: ì½œë“œ ìŠ¤íƒ€íŠ¸ê°€ ì§„í–‰ ì¤‘ì¼ ê²½ìš° ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ì„±ê³µ í™•ë¥  ì¦ê°€

---

## êµ¬í˜„ ìƒì„¸

### Phase 1: Session Start API Call

```typescript
async function executePhase1(page: Page): Promise<void> {
  // Step 0: ë°±ì—”ë“œ ì›œì—… (ìµœëŒ€ 115ì´ˆ)
  await warmupBackend(page);

  // Step 1: ë¡œê·¸ì¸ í˜ì´ì§€ ì´ë™
  await page.goto(`${BASE_URL}/auth/login`);

  // Step 2: ë¡œê·¸ì¸ ì‹œë„ (3ë²ˆ, ìµœëŒ€ 210ì´ˆ)
  let loginSuccess = false;

  for (let attempt = 1; attempt <= 3; attempt++) {
    try {
      await page.fill('input[type="email"]', TEST_EMAIL);
      await page.fill('input[type="password"]', TEST_PASSWORD);

      const loginPromise = page.waitForResponse(
        res => res.url().includes('/api/auth/login') && res.status() === 200,
        { timeout: 60000 }
      );

      await page.click('button[type="submit"]');
      await loginPromise;

      loginSuccess = true;
      break;
    } catch (error) {
      if (attempt < 3) {
        await page.waitForTimeout(attempt * 10000);
        await page.goto(`${BASE_URL}/auth/login`);
      }
    }
  }

  if (!loginSuccess) {
    throw new Error('Login failed after 3 attempts');
  }

  // Step 3: ëŒ€ì‹œë³´ë“œ ë¡œë“œ ëŒ€ê¸°
  await page.waitForURL('**/app**');

  // Step 4: ì„¸ì…˜ ì‹œì‘ ë²„íŠ¼ í´ë¦­
  // ... (ë‚˜ë¨¸ì§€ ë¡œì§)
}
```

### íƒ€ì„ì•„ì›ƒ ì„¤ì • ìš”ì•½

| ë‹¨ê³„ | íƒ€ì„ì•„ì›ƒ | ì¬ì‹œë„ | ì´ ìµœëŒ€ ì‹œê°„ |
|------|---------|-------|------------|
| **ë°±ì—”ë“œ ì›œì—…** | 15ì´ˆ/ì‹œë„ | 6íšŒ | 115ì´ˆ |
| **ë¡œê·¸ì¸** | 60ì´ˆ/ì‹œë„ | 3íšŒ | 210ì´ˆ |
| **í•©ê³„** | - | - | **325ì´ˆ (5.4ë¶„)** |

---

## í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì½œë“œ ìŠ¤íƒ€íŠ¸ (ìµœì•…)

**ì¡°ê±´**: ë°±ì—”ë“œ 15ë¶„+ ë¹„í™œì„±

**ì˜ˆìƒ íë¦„**:
```
1. ë°±ì—”ë“œ ì›œì—…
   - Attempt 1: âŒ íƒ€ì„ì•„ì›ƒ (15ì´ˆ)
   - Attempt 2: âŒ íƒ€ì„ì•„ì›ƒ (15ì´ˆ)
   - Attempt 3: âœ… ì„±ê³µ (12ì´ˆ) â† ë°±ì—”ë“œ ê¹¨ì–´ë‚¨

2. ë¡œê·¸ì¸
   - Attempt 1: âœ… ì„±ê³µ (2ì´ˆ) â† ë°±ì—”ë“œ ì¤€ë¹„ ì™„ë£Œ

3. ì´ ì‹œê°„: ~52ì´ˆ
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì›œ ìƒíƒœ (ìµœì„ )

**ì¡°ê±´**: ë°±ì—”ë“œ 5ë¶„ ì „ ë§ˆì§€ë§‰ ìš”ì²­

**ì˜ˆìƒ íë¦„**:
```
1. ë°±ì—”ë“œ ì›œì—…
   - Attempt 1: âœ… ì„±ê³µ (300ms)

2. ë¡œê·¸ì¸
   - Attempt 1: âœ… ì„±ê³µ (500ms)

3. ì´ ì‹œê°„: ~4ì´ˆ
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ë¶€ë¶„ ì½œë“œ ìŠ¤íƒ€íŠ¸ (ì¤‘ê°„)

**ì¡°ê±´**: ë°±ì—”ë“œ 17ë¶„ ë¹„í™œì„± (ë§‰ ìŠ¬ë¦½)

**ì˜ˆìƒ íë¦„**:
```
1. ë°±ì—”ë“œ ì›œì—…
   - Attempt 1: âŒ íƒ€ì„ì•„ì›ƒ (15ì´ˆ)
   - Attempt 2: âœ… ì„±ê³µ (8ì´ˆ)

2. ë¡œê·¸ì¸
   - Attempt 1: âœ… ì„±ê³µ (3ì´ˆ)

3. ì´ ì‹œê°„: ~29ì´ˆ
```

---

## ì˜ˆìƒ ê²°ê³¼

### ì„±ê³µë¥  ì˜ˆì¸¡

| ë°±ì—”ë“œ ìƒíƒœ | ì›œì—… ì„±ê³µë¥  | ë¡œê·¸ì¸ ì„±ê³µë¥  | ì´ ì„±ê³µë¥  |
|-----------|----------|------------|---------|
| **ìŠ¬ë¦½ (15ë¶„+)** | 95% | 98% | 93% |
| **ì›œ (0-15ë¶„)** | 100% | 100% | 100% |
| **í‰ê· ** | 97.5% | 99% | **96.5%** |

### ì‹¤í–‰ ì‹œê°„ ì˜ˆì¸¡

| ë°±ì—”ë“œ ìƒíƒœ | ì›œì—… ì‹œê°„ | ë¡œê·¸ì¸ ì‹œê°„ | ì´ ì‹œê°„ |
|-----------|---------|----------|--------|
| **ìŠ¬ë¦½ (15ë¶„+)** | 30-50ì´ˆ | 2-5ì´ˆ | 32-55ì´ˆ |
| **ì›œ (0-15ë¶„)** | 0-3ì´ˆ | 0.5-2ì´ˆ | 0.5-5ì´ˆ |
| **í‰ê· ** | 15-26ì´ˆ | 1.25-3.5ì´ˆ | **16.25-29.5ì´ˆ** |

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### Q1: ë°±ì—”ë“œ ì›œì—… 6ë²ˆ ëª¨ë‘ ì‹¤íŒ¨

**ì›ì¸**:
- Render ì„œë²„ ë‹¤ìš´
- ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ
- ë°±ì—”ë“œ ë°°í¬ ì§„í–‰ ì¤‘

**í•´ê²°**:
1. Render ëŒ€ì‹œë³´ë“œ í™•ì¸ (https://render.com)
2. ìˆ˜ë™ìœ¼ë¡œ ë°±ì—”ë“œ URL ì ‘ì† í…ŒìŠ¤íŠ¸
3. ë°±ì—”ë“œ íŒ€ì— ìƒíƒœ í™•ì¸ ìš”ì²­

### Q2: ë¡œê·¸ì¸ 3ë²ˆ ëª¨ë‘ ì‹¤íŒ¨

**ì›ì¸**:
- í…ŒìŠ¤íŠ¸ ê³„ì • ë¯¸ìƒì„± (`test@example.com`)
- ë°±ì—”ë“œ DB (Supabase) ë¬¸ì œ
- ì¸ì¦ ë¡œì§ ì—ëŸ¬

**í•´ê²°**:
1. ìŠ¤í¬ë¦°ìƒ· í™•ì¸ (`flow-screenshots/phase-1-login-attempt-*`)
2. HTML ë¦¬í¬íŠ¸ í™•ì¸ (`session-flow-report.html`)
3. ìˆ˜ë™ìœ¼ë¡œ í”„ë¡œë•ì…˜ì—ì„œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸

### Q3: ì›œì—… ì„±ê³µí–ˆì§€ë§Œ ë¡œê·¸ì¸ ì‹¤íŒ¨

**ì›ì¸**:
- `/api/health`ëŠ” ì„±ê³µí•˜ì§€ë§Œ `/api/auth/login`ì€ DB ì—°ê²° í•„ìš”
- Supabase DB ì½œë“œ ìŠ¤íƒ€íŠ¸ (ë³„ë„ íƒ€ì´ë°)

**í•´ê²°**:
- ì´ë¯¸ ë¡œê·¸ì¸ ì¬ì‹œë„ ë¡œì§ì´ ì²˜ë¦¬
- 3ë²ˆ ì‹œë„ ì¤‘ ì„±ê³µí•  í™•ë¥  95%+

### Q4: CI/CDì—ì„œ ê°„í—ì  ì‹¤íŒ¨

**ì›ì¸**:
- GitHub Actions ëŸ¬ë„ˆ ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì •
- Vercel ë°°í¬ ì™„ë£Œ ì „ í…ŒìŠ¤íŠ¸ ì‹œì‘

**í•´ê²°**:
1. ì›Œí¬í”Œë¡œìš°ì˜ Vercel ë°°í¬ ëŒ€ê¸° ì‹œê°„ ì¦ê°€ (120ì´ˆ â†’ 180ì´ˆ)
2. ë¡œê·¸ í™•ì¸í•˜ì—¬ íŒ¨í„´ íŒŒì•…
3. ìˆ˜ë™ ì¬ì‹¤í–‰ (Manual Dispatch)

---

## ì‹¤í–‰ ë°©ë²•

### ë¡œì»¬ í…ŒìŠ¤íŠ¸

```bash
# í”„ë¡œë•ì…˜ í™˜ê²½ í…ŒìŠ¤íŠ¸
VITE_APP_URL=https://be-more-frontend.vercel.app \
VITE_API_URL=https://bemorebackend.onrender.com \
npm run verify:session
```

### CI/CD ìë™ ì‹¤í–‰

- **Push to main**: `src/**` ë³€ê²½ ì‹œ ìë™ ì‹¤í–‰
- **Pull Request**: ìë™ ì‹¤í–‰ + PR ì½”ë©˜íŠ¸
- **Manual Dispatch**: Actions íƒ­ì—ì„œ ìˆ˜ë™ ì‹¤í–‰

### ê²°ê³¼ í™•ì¸

- **ì½˜ì†”**: ì‹¤ì‹œê°„ ë¡œê·¸
- **HTML ë¦¬í¬íŠ¸**: `session-flow-report.html`
- **ìŠ¤í¬ë¦°ìƒ·**: `flow-screenshots/` ë””ë ‰í† ë¦¬
- **GitHub Artifacts**: 30ì¼ ë³´ê´€

---

## ì°¸ê³  ìë£Œ

- [Render í”„ë¦¬í‹°ì–´ ì œí•œì‚¬í•­](https://render.com/docs/free#free-web-services)
- [Playwright íƒ€ì„ì•„ì›ƒ ì„¤ì •](https://playwright.dev/docs/test-timeouts)
- [GitHub Actions ì›Œí¬í”Œë¡œìš°](.github/workflows/e2e-session.yml)
- [ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸](scripts/verify-session-flow.ts)

---

**ì‘ì„±ì**: BeMore Frontend íŒ€
**ìµœì¢… ìˆ˜ì •**: 2025-01-11
